<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>XanaHealth - Patients List</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.css"/>
    <style>
      *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

      :root {
        --green: #4a8f75;
        --green-dark: #3d7360;
        --green-light: #e8f5f1;
        --green-lighter: #d5ebe4;
        --green-border: #4a8f75;
        --gray-bg: #f4f6f6;
        --input-bg: #e8edef;
        --border: #d9e2e2;
      }

      body { font-family: 'Inter', sans-serif; background-color: #f5f5f5; color: #333; }
      .container { display: flex; min-height: 100vh; }

      /* ── Sidebar ── */
      .sidebar {
        width: 240px; background-color: #fff; border-right: 1px solid #e5e5e5;
        display: flex; flex-direction: column; flex-shrink: 0;
        height: 100vh; position: sticky; top: 0; overflow-y: auto;
      }
      .logo { padding: 20px 24px; font-size: 20px; font-weight: 600; flex-shrink: 0; }
      .logo span:first-child { color: #333; }
      .logo span:last-child { color: var(--green); }
      .nav-section { padding: 12px 0; flex-shrink: 0; }
      .nav-label { padding: 8px 24px; font-size: 11px; font-weight: 600; color: #9ca3af; text-transform: uppercase; letter-spacing: 0.5px; }
      .nav-item { display: flex; align-items: center; padding: 10px 24px; color: #6b7280; text-decoration: none; font-size: 14px; cursor: pointer; transition: background-color 0.2s; }
      .nav-item:hover { background: #f9fafb; }
      .nav-item.active { color: var(--green); border-right: 3px solid var(--green); }
      .nav-item svg { width: 18px; height: 18px; margin-right: 12px; opacity: 0.6; flex-shrink: 0; }
      .sidebar-spacer { flex: 1; }
      .user-section { padding: 16px 24px; border-top: 1px solid #e5e5e5; flex-shrink: 0; }
      .user-profile { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; }
      .user-avatar { width: 36px; height: 36px; border-radius: 50%; background-color: var(--green); color: #fff; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 600; flex-shrink: 0; }
      .user-info h4 { font-size: 14px; font-weight: 600; color: #333; }
      .user-info p { font-size: 12px; color: #9ca3af; }
      .user-actions { display: flex; flex-direction: column; gap: 2px; }
      .user-action { display: flex; align-items: center; padding: 7px 0; color: #6b7280; text-decoration: none; font-size: 13px; cursor: pointer; }
      .user-action svg { width: 16px; height: 16px; margin-right: 10px; opacity: 0.6; flex-shrink: 0; }

      /* ── Main ── */
      .main-content { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
      .header { background-color: #fff; padding: 0 32px; height: 64px; border-bottom: 1px solid #e5e5e5; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
      .header h1 { font-size: 22px; font-weight: 600; color: #111827; }
      .header-right { display: flex; align-items: center; gap: 20px; }
      .notification-icon { width: 20px; height: 20px; cursor: pointer; color: #6b7280; }
      .company-dropdown { display: flex; align-items: center; gap: 8px; padding: 8px 16px; background-color: #fff; border: 1px solid #e5e5e5; border-radius: 6px; cursor: pointer; color: #9ca3af; font-size: 14px; }

      /* ── Views ── */
      .view { display: none; flex: 1; flex-direction: column; overflow-y: auto; }
      .view.active { display: flex; }

      /* ── Patient List View ── */
      .content-area { padding: 24px 32px; flex: 1; background-color: #F4F6F5; }
      .controls { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; gap: 16px; }
      .controls-left { display: flex; gap: 12px; flex: 1; }
      .filter-btn, .action-btn { display: flex; align-items: center; gap: 8px; padding: 10px 16px; background-color: #fff; border: 1px solid #d1d5db; border-radius: 6px; cursor: pointer; font-size: 14px; color: #374151; font-family: inherit; }
      .search-box { display: flex; align-items: center; gap: 8px; padding: 10px 16px; background-color: #fff; border: 1px solid #d1d5db; border-radius: 6px; flex: 1; max-width: 300px; }
      .search-box input { border: none; outline: none; flex: 1; font-size: 14px; color: #6b7280; font-family: inherit; }
      .controls-right { display: flex; gap: 12px; }
      .export-btn, .import-btn { padding: 10px 20px; background-color: #fff; border: 1px solid #d1d5db; border-radius: 6px; cursor: pointer; font-size: 14px; color: #374151; font-weight: 500; font-family: inherit; }
      .add-patient-btn { display: flex; align-items: center; gap: 8px; padding: 10px 20px; background-color: var(--green); border: none; border-radius: 6px; cursor: pointer; font-size: 14px; color: #fff; font-weight: 500; font-family: inherit; }
      .add-patient-btn:hover { background: var(--green-dark); }
      .applied-filters { display: flex; gap: 8px; margin-bottom: 16px; align-items: center; flex-wrap: wrap; }
      .filter-label { font-size: 13px; color: #6b7280; }
      .filter-tag { display: flex; align-items: center; gap: 6px; padding: 6px 12px; background-color: #f3f4f6; border-radius: 4px; font-size: 13px; color: #374151; }
      .filter-tag .close { cursor: pointer; opacity: 0.6; }
      .clear-filter { color: #ef4444; font-size: 13px; cursor: pointer; font-weight: 500; }
      .table-container { background-color: #fff; border-radius: 8px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
      table { width: 100%; border-collapse: collapse; }
      thead { background-color: #dfe5e5; border-bottom: 1px solid #e5e5e5; }
      th { padding: 12px 16px; text-align: left; font-size: 12px; font-weight: 600; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px; }
      td { padding: 16px; border-bottom: 1px solid #f3f4f6; font-size: 14px; color: #374151; }
      tbody tr { cursor: pointer; transition: background-color 0.15s; }
      tbody tr:hover { background: #f9fafb; }
      .checkbox { width: 16px; height: 16px; border: 1px solid #d1d5db; border-radius: 3px; cursor: pointer; }
      .patient-image { width: 36px; height: 36px; border-radius: 50%; object-fit: cover; }
      .new-visit-btn { padding: 6px 16px; background-color: #F4F6F5; border: 1px solid #a7f3d0; border-radius: 6px; cursor: pointer; font-size: 13px; color: var(--green); font-weight: 600; font-family: inherit; }
      .action-icon { width: 18px; height: 18px; opacity: 0.5; cursor: pointer; }
      .action-icon:hover { opacity: 1; }
      .pagination { display: flex; justify-content: flex-end; align-items: center; padding: 16px 24px; gap: 8px; }
      .page-btn { padding: 8px 12px; border: 1px solid #d1d5db; background-color: #fff; border-radius: 4px; cursor: pointer; font-size: 14px; color: #374151; font-family: inherit; }
      .page-btn.active { background-color: var(--green); color: #fff; border-color: var(--green); }
      .page-btn:disabled { opacity: 0.4; cursor: not-allowed; }
      .page-info { font-size: 14px; color: #9ca3af; margin-left: 8px; }

      /* ── Patient Detail View ── */
      .detail-area { padding: 24px 32px; background-color: #F4F6F5; flex: 1; }
      .back-btn { display: inline-flex; align-items: center; gap: 6px; background: none; border: none; cursor: pointer; font-size: 14px; color: #374151; padding: 0; font-weight: 500; font-family: inherit; }
      .back-btn:hover { color: var(--green); }
      .new-visit-header-btn { padding: 10px 24px; background-color: var(--green); color: #fff; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600; font-family: inherit; }
      .new-visit-header-btn:hover { background: var(--green-dark); }
      .patient-info-card { background: #fff; border-radius: 10px; padding: 28px; margin-bottom: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.07); }
      .patient-info-card h3 { font-size: 15px; font-weight: 600; color: #374151; margin-bottom: 20px; }
      .patient-info-body { display: flex; gap: 24px; align-items: flex-start; }
      .patient-photo-wrap { display: flex; flex-direction: column; align-items: center; gap: 8px; }
      .patient-photo { width: 100px; height: 100px; border-radius: 50%; object-fit: cover; }
      .patient-photo-name { font-size: 14px; font-weight: 600; color: #111827; text-align: center; }
      .patient-photo-gender { font-size: 12px; color: #9ca3af; text-align: center; }
      .patient-info-grid { flex: 1; display: grid; grid-template-columns: 1fr 1fr; gap: 16px 32px; }
      .info-field label { font-size: 12px; color: #9ca3af; display: block; margin-bottom: 4px; }
      .info-field span { font-size: 14px; color: #111827; font-weight: 500; }
      .notes-section { margin-top: 16px; }
      .notes-section label { font-size: 12px; color: #9ca3af; display: block; margin-bottom: 6px; }
      .notes-section textarea { width: 100%; border: 1px solid #e5e5e5; border-radius: 6px; padding: 10px; font-size: 13px; color: #374151; resize: vertical; min-height: 70px; font-family: inherit; outline: none; }
      .edit-btn { display: block; margin-left: auto; margin-top: 12px; padding: 8px 24px; background-color: var(--green); color: #fff; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500; font-family: inherit; }
      .invoices-card { background: #fff; border-radius: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.07); overflow: hidden; }
      .invoices-header { display: flex; justify-content: space-between; align-items: center; padding: 18px 24px; border-bottom: 1px solid #f3f4f6; }
      .invoices-header h3 { font-size: 15px; font-weight: 600; color: #374151; }
      .eye-btn { background: none; border: none; cursor: pointer; opacity: 0.5; }
      .eye-btn:hover { opacity: 1; }

      /* ── New Visit Form View ── */
      .form-view-area { padding: 32px; background-color: #F4F6F5; flex: 1; display: flex; flex-direction: column; align-items: center; }
      .form-card { background: #fff; border-radius: 10px; padding: 36px; width: 100%; max-width: 520px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); }
      .form-card h2 { font-size: 20px; font-weight: 700; color: #111827; text-align: center; margin-bottom: 4px; }
      .form-card .form-subtitle { font-size: 13px; color: #9ca3af; text-align: center; margin-bottom: 28px; }
      .form-group-nv { margin-bottom: 18px; }
      .form-group-nv label { display: block; font-size: 13px; font-weight: 500; color: #374151; margin-bottom: 6px; }
      .form-group-nv select, .form-group-nv input, .form-group-nv textarea {
        width: 100%; padding: 10px 14px; border: 1px solid #e5e5e5; border-radius: 6px;
        font-size: 14px; color: #374151; background-color: #f9fafb; outline: none;
        font-family: inherit; transition: border-color 0.2s;
      }
      .form-group-nv select:focus, .form-group-nv input:focus { border-color: var(--green); background-color: #fff; }
      .form-group-nv select { appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%239ca3af' d='M6 9L1 4h10z'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 14px center; }
      .form-actions { display: flex; gap: 12px; margin-top: 24px; }
      .cancel-btn { flex: 1; padding: 10px; background: #fff; border: 1px solid #d1d5db; border-radius: 6px; cursor: pointer; font-size: 14px; color: #ef4444; font-weight: 500; font-family: inherit; }
      .save-btn { flex: 2; padding: 10px; background: var(--green); border: none; border-radius: 6px; cursor: pointer; font-size: 14px; color: #fff; font-weight: 600; font-family: inherit; }
      .save-btn:hover { background: var(--green-dark); }

      /* ── Add Patient Form (full XanaHealth form) ── */
      .add-patient-area {
        padding: 0 32px 40px;
        background: #F4F6F5;
        flex: 1;
        overflow-y: auto;
      }
      .add-patient-inner {
        background: #fff;
        border-radius: 10px;
        padding: 32px 36px 40px;
        margin-top: 24px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.07);
        max-width: 900px;
        margin-left:150px;
      }

      /* Section headers & collapse */
      .section-header {
        display: flex; align-items: center; justify-content: space-between;
        padding: 14px 0; border-bottom: 2px solid #e0e8e5;
        margin-bottom: 24px; margin-top: 36px;
        cursor: pointer;
      }
      .section-header:first-of-type { margin-top: 0; }
      .section-header h2 { font-size: 17px; font-weight: 600; color: #1a1a1a; }
      .collapse-btn {
        background: none; border: none; color: var(--green);
        font-size: 13px; cursor: pointer; text-decoration: underline;
        font-family: inherit; font-weight: 500;
        display: flex; align-items: center; gap: 5px; white-space: nowrap;
      }
      .collapse-btn:hover { color: var(--green-dark); }
      .section-body {
        overflow: hidden;
        transition: max-height 0.35s ease, opacity 0.3s ease;
        max-height: 2000px;
        opacity: 1;
      }
      .section-body.collapsed { max-height: 0 !important; opacity: 0; }

      /* Form rows/groups */
      .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 20px; }
      .form-row.single { grid-template-columns: 1fr; }
      .form-group { display: flex; flex-direction: column; gap: 6px; }
      .form-group label { font-size: 14px; font-weight: 500; color: #374151; display: flex; align-items: center; gap: 6px; }
      .required-tag { font-size: 11px; color: #dc3545; font-weight: 400; }
      .optional-tag { font-size: 11px; color: #9ca3af; font-weight: 400; }

      .form-group input[type="text"],
      .form-group input[type="email"],
      .form-group input[type="date"],
      .form-group select {
        padding: 12px 14px; border: 1px solid var(--border); border-radius: 8px;
        background: var(--input-bg); font-size: 14px; color: #374151;
        font-family: inherit; transition: all .2s; width: 100%;
      }
      .form-group input:focus, .form-group select:focus {
        outline: none; background: var(--green-lighter);
        border-color: var(--green); box-shadow: 0 0 0 3px rgba(74,143,117,.15);
      }
      .form-group select {
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 16 16'%3E%3Cpath fill='%236c757d' d='M8 11L3 6h10z'/%3E%3C/svg%3E");
        background-repeat: no-repeat; background-position: right 14px center; padding-right: 36px; cursor: pointer;
      }

      .input-with-btn { position: relative; display: flex; align-items: center; }
      .input-with-btn input { padding-right: 148px; }
      .fetch-btn {
        position: absolute; right: 6px; background: var(--green); color: #fff;
        border: none; padding: 8px 16px; border-radius: 6px;
        font-size: 13px; font-weight: 500; cursor: pointer; font-family: inherit;
        transition: background .2s; white-space: nowrap;
      }
      .fetch-btn:hover { background: var(--green-dark); }

      /* Phone fields */
      .phone-group { position: relative; }
      .phone-group .iti { width: 100%; }
      .phone-group .iti__flag-container { background: var(--green-light); border-right: 1px solid rgba(74,143,117,.3); border-radius: 8px 0 0 8px; }
      .phone-group .iti__selected-flag { background: var(--green-light) !important; border-radius: 8px 0 0 8px; padding: 0 10px 0 12px; }
      .phone-group .iti__selected-flag:hover, .phone-group .iti__selected-flag:focus { background: var(--green-lighter) !important; }
      .phone-group input[type="tel"] {
        width: 100%; padding: 12px 14px; border: 2px solid var(--green-border);
        border-radius: 8px; background: var(--green-light); font-size: 14px;
        color: var(--green-dark); font-family: inherit; font-weight: 500; transition: all .2s;
      }
      .phone-group input[type="tel"]:focus { outline: none; background: var(--green-lighter); box-shadow: 0 0 0 3px rgba(74,143,117,.2); }
      .phone-group input[type="tel"]::placeholder { color: #7fb5a0; }

      /* Upload */
      .upload-box {
        display: flex; align-items: center; justify-content: center;
        width: 100%; height: 180px; border: 2px dashed #cbd5e1; border-radius: 12px;
        background: #f8fafc; cursor: pointer; transition: all .25s; text-align: center;
      }
      .upload-box:hover { border-color: var(--green); background: #f0fdf4; }
      .upload-icon { font-size: 34px; color: #9ca3af; margin-bottom: 8px; }
      .upload-title { font-size: 15px; font-weight: 600; margin-bottom: 4px; }
      .upload-sub { font-size: 13px; color: #64748b; }
      .upload-actions { display: flex; gap: 12px; margin-top: 14px; }

      .btn-green {
        display: flex; align-items: center; gap: 7px; padding: 9px 18px;
        background: var(--green); border: none; border-radius: 6px; cursor: pointer;
        font-size: 14px; color: #fff; font-weight: 500; white-space: nowrap; font-family: inherit;
      }
      .btn-green:hover { background: var(--green-dark); }
      .btn-outline-green {
        display: flex; align-items: center; gap: 7px; padding: 9px 18px;
        background: #fff; border: 1px solid var(--green); border-radius: 6px; cursor: pointer;
        font-size: 14px; color: var(--green); font-weight: 500; white-space: nowrap; font-family: inherit;
      }
      .btn-outline-green:hover { background: var(--green-light); }

      .add-patient-toolbar {
        display: flex; align-items: center; gap: 12px; padding: 16px 0 0;
        flex-wrap: wrap;
      }

      @media(max-width: 768px) {
        .form-row { grid-template-columns: 1fr; }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Sidebar -->
      <aside class="sidebar">
        <div class="logo"><span>Xana</span><span>Health</span></div>
        <nav class="nav-section">
          <div class="nav-label">RECEPTION/CASHIER</div>
          <a href="#" class="nav-item">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>Dashboard
          </a>
          <a href="new_patient.html" class="nav-item" onclick="showAddPatient(event)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>New Patient File
          </a>
          <a href="#" class="nav-item active" id="nav-patients" onclick="showList(event)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>Patients List
          </a>
          <a href="patient_visits.html" class="nav-item">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>Patient Visits
          </a>
          <a href="appointments.html" class="nav-item">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>Appointments
          </a>
          <a href="billing.html" class="nav-item">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg>Billing
          </a>
        </nav>
        <div class="sidebar-spacer"></div>
        <div class="user-section">
          <div class="user-profile">
            <div class="user-avatar">JD</div>
            <div class="user-info"><h4>Jane Doe</h4><p>Receptionist</p></div>
          </div>
          <div class="user-actions">
            <a href="#" class="user-action">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>Help
            </a>
            <a href="#" class="user-action">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>Logout
            </a>
          </div>
        </div>
      </aside>

      <!-- Main Content -->
      <main class="main-content">
        <header class="header">
          <h1 id="page-title">Patient List</h1>
          <div class="header-right">
            <svg class="notification-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/>
            </svg>
            <div class="company-dropdown">
              <span>Company Logo</span>
              <svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor"><path d="M6 9L1 4h10z"/></svg>
            </div>
          </div>
        </header>

        <!-- ==================== VIEW 1: PATIENT LIST ==================== -->
        <div class="view active" id="view-list">
          <div class="content-area">
            <div class="controls">
              <div class="controls-left">
                <button class="filter-btn">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="4" y1="21" x2="4" y2="14"/><line x1="4" y1="10" x2="4" y2="3"/><line x1="12" y1="21" x2="12" y2="12"/>
                    <line x1="12" y1="8" x2="12" y2="3"/><line x1="20" y1="21" x2="20" y2="16"/><line x1="20" y1="12" x2="20" y2="3"/>
                    <line x1="1" y1="14" x2="7" y2="14"/><line x1="9" y1="8" x2="15" y2="8"/><line x1="17" y1="16" x2="23" y2="16"/>
                  </svg>Filter by
                </button>
                <div class="search-box">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
                  <input type="text" placeholder="Search all patients" />
                </div>
                <button class="action-btn">Action <svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor"><path d="M6 9L1 4h10z"/></svg></button>
              </div>
              <div class="controls-right">
                <button class="export-btn">Export</button>
                <button class="import-btn">Import</button>
                <button class="add-patient-btn" onclick="showAddPatient(event)">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                  Add New Patient
                </button>
              </div>
            </div>
            <div class="applied-filters">
              <span class="filter-label">Applied Filter</span>
              <div class="filter-tag">Recently added <span class="close">✕</span></div>
              <div class="filter-tag">Recently Updated <span class="close">✕</span></div>
              <span class="clear-filter">Clear filter</span>
            </div>
            <div class="table-container">
              <table>
                <thead>
                  <tr>
                    <th><input type="checkbox" class="checkbox" /></th>
                    <th>Image</th><th>File Number</th><th>First Name</th><th>Last Name</th>
                    <th>Gender</th><th>Date of Birth</th><th>Phone Number</th><th>Actions</th>
                  </tr>
                </thead>
                <tbody id="patient-tbody"></tbody>
              </table>
              <div class="pagination">
                <button class="page-btn" disabled>Previous</button>
                <button class="page-btn active">1</button>
                <button class="page-btn">2</button>
                <button class="page-btn">3</button>
                <button class="page-btn">Next</button>
                <span class="page-info">1/03</span>
              </div>
            </div>
          </div>
        </div>

        <!-- ==================== VIEW 2: PATIENT DETAIL ==================== -->
        <div class="view" id="view-detail">
          <div class="detail-area">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
              <button class="back-btn" onclick="showList(event)">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>Back
              </button>
              <button class="new-visit-header-btn" onclick="showNewVisit(event)">New Visit</button>
            </div>
            <div class="patient-info-card">
              <h3>Patient Information</h3>
              <div class="patient-info-body">
                <div class="patient-photo-wrap">
                  <img id="detail-photo" src="" alt="Patient" class="patient-photo" />
                  <div class="patient-photo-name" id="detail-fullname"></div>
                  <div class="patient-photo-gender" id="detail-gender"></div>
                </div>
                <div style="flex:1;">
                  <div class="patient-info-grid">
                    <div class="info-field"><label>Email</label><span id="detail-email"></span></div>
                    <div class="info-field"><label>File Number</label><span id="detail-filenum"></span></div>
                    <div class="info-field"><label>Phone number</label><span id="detail-phone"></span></div>
                    <div class="info-field"><label>NHES ID</label><span id="detail-nhes"></span></div>
                    <div class="info-field"><label>Address</label><span id="detail-address"></span></div>
                    <div class="info-field"><label>Age</label><span id="detail-age"></span></div>
                  </div>
                  <div class="notes-section">
                    <label>Additional Notes</label>
                    <textarea placeholder="Add notes about this patient..."></textarea>
                  </div>
                  <button class="edit-btn">Edit</button>
                </div>
              </div>
            </div>
            <div class="invoices-card">
              <div class="invoices-header">
                <h3>Past Invoices</h3>
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="opacity:0.4;cursor:pointer;"><circle cx="12" cy="5" r="1"/><circle cx="12" cy="12" r="1"/><circle cx="12" cy="19" r="1"/></svg>
              </div>
              <table>
                <thead><tr><th>Date</th><th>Treated By</th><th>Invoice</th><th>Charges</th><th>Debt</th><th>Actions</th></tr></thead>
                <tbody>
                  <tr><td>23/05/2023 <span style="color:#9ca3af;font-size:12px;">(30 mins ago)</span></td><td>Dr. Jacob Ryan</td><td>03336/2022</td><td>Rwf 2,000,000</td><td>Rwf 2,000,000</td><td><button class="eye-btn"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg></button></td></tr>
                  <tr><td>23/05/2023 <span style="color:#9ca3af;font-size:12px;">(30 mins ago)</span></td><td>Dr. Jacob Ryan</td><td>03336/2022</td><td>Rwf 2,000,000</td><td>Rwf 2,000,000</td><td><button class="eye-btn"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg></button></td></tr>
                  <tr><td>23/05/2023 <span style="color:#9ca3af;font-size:12px;">(30 mins ago)</span></td><td>Dr. Jacob Ryan</td><td>03336/2022</td><td>Rwf 2,000,000</td><td>Rwf 2,000,000</td><td><button class="eye-btn"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg></button></td></tr>
                </tbody>
              </table>
              <div class="pagination">
                <button class="page-btn" disabled>Previous</button>
                <button class="page-btn active">1</button>
                <button class="page-btn">2</button>
                <button class="page-btn">Next</button>
                <span class="page-info">1/∞</span>
              </div>
            </div>
          </div>
        </div>

        <!-- ==================== VIEW 3: NEW VISIT FORM ==================== -->
        <div class="view" id="view-new-visit">
          <div class="form-view-area">
            <button class="back-btn" style="align-self:flex-start;" onclick="showDetail(event)">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>Back
            </button>
            <div class="form-card">
              <h2>New Visit Information</h2>
              <p class="form-subtitle">Add new visit information</p>
              <div class="form-group-nv"><label>Department</label><select><option value="">Select a department</option><option>General Medicine</option><option>Pediatrics</option><option>Cardiology</option><option>Orthopedics</option><option>Dermatology</option></select></div>
              <div class="form-group-nv"><label>Preferred Doctor (optional)</label><select><option value="">Select doctor</option><option>Dr. Jacob Ryan</option><option>Dr. Amina Otieno</option><option>Dr. Chen Wei</option></select></div>
              <div class="form-group-nv"><label>Insurance</label><select><option value="">Select insurance</option><option>RSSB</option><option>MMI</option><option>RADIANT</option><option>Private</option></select></div>
              <div class="form-group-nv"><label>Card Number</label><input type="text" placeholder="Enter your card number" /></div>
              <div class="form-group-nv"><label>Percentage (paid by insurance)</label><input type="text" placeholder="00%" /></div>
              <div class="form-group-nv"><label>Voucher Identification</label><input type="text" placeholder="|||||||||||||||||||" /></div>
              <div class="form-group-nv"><label>Affiliate's Name</label><input type="text" placeholder="Enter affiliate's name" /></div>
              <div class="form-group-nv"><label>Affiliate's Affectation</label><input type="text" placeholder="Enter affiliate's affectation" /></div>
              <div class="form-group-nv"><label>Caution</label><input type="text" placeholder="Enter caution" /></div>
              <div class="form-actions">
                <button class="cancel-btn" onclick="showDetail(event)">Cancel</button>
                <button class="save-btn">Save</button>
              </div>
            </div>
          </div>
        </div>

        <!-- ==================== VIEW 4: ADD NEW PATIENT (full form) ==================== -->
        <div class="view" id="view-add-patient">
          <div class="add-patient-area">
            <!-- Toolbar -->
            <div class="add-patient-toolbar">
              <button class="back-btn" onclick="showList(event)">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>Back
              </button>
              <div style="flex:1;"></div>
              <button class="filter-btn" style="font-family:inherit;">
                <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="4" y1="21" x2="4" y2="14"/><line x1="4" y1="10" x2="4" y2="3"/><line x1="12" y1="21" x2="12" y2="12"/><line x1="12" y1="8" x2="12" y2="3"/><line x1="20" y1="21" x2="20" y2="16"/><line x1="20" y1="12" x2="20" y2="3"/><line x1="1" y1="14" x2="7" y2="14"/><line x1="9" y1="8" x2="15" y2="8"/><line x1="17" y1="16" x2="23" y2="16"/></svg>
                Filter by
              </button>
              <div style="display:flex;align-items:center;gap:8px;padding:9px 14px;background:#fff;border:1px solid #d1d5db;border-radius:6px;max-width:240px;">
                <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
                <input type="text" placeholder="Search all patients" style="border:none;outline:none;flex:1;font-size:14px;color:#6b7280;font-family:inherit;background:transparent;" />
              </div>
              <button class="action-btn" style="font-family:inherit;">Action <svg width="11" height="11" viewBox="0 0 12 12" fill="currentColor"><path d="M6 9L1 4h10z"/></svg></button>
            </div>

            <!-- Full patient form -->
            <div class="add-patient-inner">
              <form id="addPatientForm" onsubmit="return false">

                <!-- PATIENT BIODATA -->
                <div class="section-header" onclick="toggleSection(this)">
                  <h2>Patient Biodata</h2>
                  <button type="button" class="collapse-btn">
                    <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="6 9 12 15 18 9"/></svg>Exapnd
                  </button>
                </div>
                <div class="section-body collapsed">
                  <div class="form-row">
                    <div class="form-group">
                      <label>National File Number</label>
                      <div class="input-with-btn">
                        <input type="text" placeholder="0000000000000"/>
                        <button type="button" class="fetch-btn">Fetch Patient Info</button>
                      </div>
                    </div>
                    <div class="form-group"><label>Internal File Number</label><input type="text" placeholder="0000000000000"/></div>
                  </div>
                  <div class="form-row">
                    <div class="form-group"><label>First Name <span class="required-tag">* Required</span></label><input type="text" placeholder="Enter patient's first name"/></div>
                    <div class="form-group"><label>Middle Name <span class="optional-tag">Optional</span></label><input type="text" placeholder="Enter patient's middle name"/></div>
                  </div>
                  <div class="form-row">
                    <div class="form-group"><label>Last Name <span class="required-tag">* Required</span></label><input type="text" placeholder="Enter patient's last name"/></div>
                    <div class="form-group">
                      <label>Gender <span class="required-tag">* Required</span></label>
                      <select><option value="">Select a gender</option><option>Male</option><option>Female</option><option>Other</option></select>
                    </div>
                  </div>
                  <div class="form-row">
                    <div class="form-group">
                      <label>Marital Status</label>
                      <select><option value="">Select marital status</option><option>Single</option><option>Married</option><option>Divorced</option><option>Widowed</option></select>
                    </div>
                    <div class="form-group"><label>Date of Birth</label><input type="date"/></div>
                  </div>
                  <div class="form-row">
                    <div class="form-group">
                      <label>Nationality</label>
                      <div class="phone-group"><input id="ap-phone-nationality" type="tel" name="nationality_phone" placeholder="Select country code"/></div>
                    </div>
                    <div class="form-group"><label>National ID</label><input type="text" placeholder="Enter National ID number"/></div>
                  </div>
                  <div class="form-row">
                    <div class="form-group"><label>Passport Number</label><input type="text" placeholder="Enter passport number"/></div>
                    <div class="form-group">
                      <label>Blood Group</label>
                      <select><option value="">Select blood group</option><option>A+</option><option>A−</option><option>B+</option><option>B−</option><option>AB+</option><option>AB−</option><option>O+</option><option>O−</option></select>
                    </div>
                  </div>
                  <div class="form-row">
                    <div class="form-group"><label>Known Allergies</label><input type="text" placeholder="e.g. Penicillin, Pollen"/></div>
                    <div class="form-group"><label>Deceased At <span class="optional-tag">If applicable</span></label><input type="date"/></div>
                  </div>
                </div>

                <!-- CONTACT INFORMATION -->
                <div class="section-header" onclick="toggleSection(this)">
                  <h2>Patient Contact Information</h2>
                  <button type="button" class="collapse-btn">
                    <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="6 9 12 15 18 9"/></svg>Expand
                  </button>
                </div>
                <div class="section-body collapsed">
                  <div class="form-row">
                    <div class="form-group"><label>Email</label><input type="email" placeholder="patient@example.com"/></div>
                    <div class="form-group">
                      <label>Phone Number 1 <span class="required-tag">* Required</span></label>
                      <div class="phone-group"><input id="ap-phone-1" type="tel" name="phone1" placeholder="Enter phone number"/></div>
                    </div>
                  </div>
                  <div class="form-row">
                    <div class="form-group">
                      <label>Phone Number 2 <span class="optional-tag">Optional</span></label>
                      <div class="phone-group"><input id="ap-phone-2" type="tel" name="phone2" placeholder="Enter phone number"/></div>
                    </div>
                    <div class="form-group"><label>Country of Residence</label><input type="text" placeholder="e.g. Rwanda"/></div>
                  </div>
                  <div class="form-row">
                    <div class="form-group"><label>Province / State</label><input type="text" placeholder="Enter province or state"/></div>
                    <div class="form-group"><label>District / Local Government</label><input type="text" placeholder="Enter district"/></div>
                  </div>
                  <div class="form-row">
                    <div class="form-group"><label>Sector / City</label><input type="text" placeholder="Enter sector or city"/></div>
                    <div class="form-group"><label>Cell</label><input type="text" placeholder="Enter cell"/></div>
                  </div>
                  <div class="form-row">
                    <div class="form-group"><label>Village</label><input type="text" placeholder="Enter village"/></div>
                    <div class="form-group"><label>Street</label><input type="text" placeholder="Enter street"/></div>
                  </div>
                </div>

                <!-- PARENT'S INFORMATION -->
                <div class="section-header" onclick="toggleSection(this)">
                  <h2>Parent's Information</h2>
                  <button type="button" class="collapse-btn">
                    <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="6 9 12 15 18 9"/></svg>Expand
                  </button>
                </div>
                <div class="section-body collapsed">
                  <div class="form-row">
                    <div class="form-group"><label>Father's Full Name</label><input type="text" placeholder="Enter father's full name"/></div>
                    <div class="form-group">
                      <label>Father's Phone Number</label>
                      <div class="phone-group"><input id="ap-phone-father" type="tel" name="father_phone" placeholder="Enter phone number"/></div>
                    </div>
                  </div>
                  <div class="form-row">
                    <div class="form-group"><label>Mother's Full Name</label><input type="text" placeholder="Enter mother's full name"/></div>
                    <div class="form-group">
                      <label>Mother's Phone Number</label>
                      <div class="phone-group"><input id="ap-phone-mother" type="tel" name="mother_phone" placeholder="Enter phone number"/></div>
                    </div>
                  </div>
                </div>

                <!-- EMERGENCY CONTACT -->
                <div class="section-header" onclick="toggleSection(this)">
                  <h2>Emergency Contact</h2>
                  <button type="button" class="collapse-btn">
                    <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="6 9 12 15 18 9"/></svg>Expand
                  </button>
                </div>
                <div class="section-body collapsed">
                  <div class="form-row">
                    <div class="form-group"><label>First Name</label><input type="text" placeholder="Enter first name"/></div>
                    <div class="form-group"><label>Last Name</label><input type="text" placeholder="Enter last name"/></div>
                  </div>
                  <div class="form-row">
                    <div class="form-group"><label>Email</label><input type="email" placeholder="emergency@example.com"/></div>
                    <div class="form-group">
                      <label>Phone Number <span class="required-tag">* Required</span></label>
                      <div class="phone-group"><input id="ap-phone-emergency" type="tel" name="emergency_phone" placeholder="Enter phone number"/></div>
                    </div>
                  </div>
                  <div class="form-row">
                    <div class="form-group"><label>Country</label><input type="text" placeholder="Enter country"/></div>
                    <div class="form-group"><label>Province / State</label><input type="text" placeholder="Enter province or state"/></div>
                  </div>
                  <div class="form-row">
                    <div class="form-group"><label>District / Local Government</label><input type="text" placeholder="Enter district"/></div>
                    <div class="form-group"><label>Sector / City</label><input type="text" placeholder="Enter sector or city"/></div>
                  </div>
                  <div class="form-row">
                    <div class="form-group"><label>Cell</label><input type="text" placeholder="Enter cell"/></div>
                    <div class="form-group"><label>Village</label><input type="text" placeholder="Enter village"/></div>
                  </div>
                  <div class="form-row single">
                    <div class="form-group"><label>Street</label><input type="text" placeholder="Enter street"/></div>
                  </div>
                </div>

                <!-- PATIENT IMAGE -->
                <div class="section-header" onclick="toggleSection(this)">
                  <h2>Patient's Image <span class="optional-tag" style="font-size:13px;font-weight:400;">Optional</span></h2>
                  <button type="button" class="collapse-btn">
                    <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="6 9 12 15 18 9"/></svg>Expand
                  </button>
                </div>
                <div class="section-body collpased">
                  <label class="upload-box">
                    <input type="file" accept=".png,.jpg,.jpeg" hidden/>
                    <div>
                      <div class="upload-icon">⬆</div>
                      <p class="upload-title">Upload patient photo here</p>
                      <p class="upload-sub">Supported formats: PNG, JPEG &nbsp;·&nbsp; Max 5 MB</p>
                    </div>
                  </label>
                  <div class="upload-actions">
                    <button type="button" class="btn-green">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                      Choose File
                    </button>
                    <button type="button" class="btn-outline-green">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></svg>
                      Take Photo With Webcam
                    </button>
                  </div>
                </div>

                <!-- SUBMIT -->
                <div style="display:flex;justify-content:flex-end;gap:12px;margin-top:32px;padding-top:24px;border-top:1px solid #e5e5e5;">
                  <button type="button" class="btn-outline-green" onclick="showList(event)">Cancel</button>
                  <button type="submit" class="btn-green" style="padding:11px 32px;font-size:15px;font-weight:600;">Save Patient</button>
                </div>

              </form>
            </div>
          </div>
        </div>

      </main>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js"></script>
    <script>
      // ---- Patient Data ----
      const patients = [
        { id:1, img:'https://i.pravatar.cc/150?img=1', file:'112/001', firstName:'Raekwon', lastName:'Gbeho', gender:'Female', dob:'23/05/1992', phone:'+250000000000', email:'raekwon@gmail.com', nhes:'0000000000000000', address:'KN 78 Street, Kigali' },
        { id:2, img:'https://i.pravatar.cc/150?img=5', file:'112/002', firstName:'Milani', lastName:'Mostafa', gender:'Female', dob:'23/05/1998', phone:'+250000000000', email:'milani@gmail.com', nhes:'0000000000000001', address:'KG 12 Avenue, Kigali' },
        { id:3, img:'https://i.pravatar.cc/150?img=9', file:'112/003', firstName:'Tawana', lastName:'Adébáyò', gender:'Female', dob:'13/04/1999', phone:'+250000000000', email:'tawana@gmail.com', nhes:'0000000000000002', address:'KN 45 Road, Kigali' },
        { id:4, img:'https://i.pravatar.cc/150?img=12', file:'112/004', firstName:'Tamira', lastName:'Mostafa', gender:'Male', dob:'01/09/1962', phone:'+250000000000', email:'tamira@gmail.com', nhes:'0000000000000003', address:'KG 33 Street, Kigali' },
        { id:5, img:'https://i.pravatar.cc/150?img=20', file:'112/005', firstName:'Raekwon', lastName:'Adimb...', gender:'Female', dob:'23/05/2002', phone:'+250000000000', email:'raekwon2@gmail.com', nhes:'0000000000000004', address:'KN 22 Street, Kigali' },
        { id:6, img:'https://i.pravatar.cc/150?img=33', file:'112/006', firstName:'Imani', lastName:'Badu', gender:'Male', dob:'23/05/1992', phone:'+250000000000', email:'imani@gmail.com', nhes:'0000000000000005', address:'KG 5 Avenue, Kigali' },
        { id:7, img:'https://i.pravatar.cc/150?img=47', file:'112/007', firstName:'Jelani', lastName:'Chidubem', gender:'Female', dob:'13/02/1940', phone:'+250000000000', email:'jelani@gmail.com', nhes:'0000000000000006', address:'KN 90 Road, Kigali' },
        { id:8, img:'https://i.pravatar.cc/150?img=52', file:'112/008', firstName:'Jelani', lastName:'Kasongo', gender:'Male', dob:'07/10/1996', phone:'+250000000000', email:'jelani2@gmail.com', nhes:'0000000000000007', address:'KG 18 Street, Kigali' },
        { id:9, img:'https://i.pravatar.cc/150?img=44', file:'112/009', firstName:'Ogechukwu', lastName:'Ezel...', gender:'Female', dob:'03/09/1992', phone:'+250000000000', email:'ogechukwu@gmail.com', nhes:'0000000000000008', address:'KN 55 Avenue, Kigali' },
        { id:10, img:'https://i.pravatar.cc/150?img=60', file:'112/010', firstName:'Mohammed', lastName:'Chi...', gender:'Male', dob:'23/05/1992', phone:'+250000000000', email:'mohammed@gmail.com', nhes:'0000000000000009', address:'KG 77 Road, Kigali' },
      ];

      let currentPatient = null;
      let phoneInstancesInit = false;

      function calcAge(dob) {
        const parts = dob.split('/');
        if (parts.length !== 3) return dob;
        const birth = new Date(+parts[2], +parts[1]-1, +parts[0]);
        const now = new Date();
        let age = now.getFullYear() - birth.getFullYear();
        if (now < new Date(now.getFullYear(), birth.getMonth(), birth.getDate())) age--;
        return `${age} years (${dob})`;
      }

      function buildTable() {
        const tbody = document.getElementById('patient-tbody');
        tbody.innerHTML = patients.map(p => `
          <tr onclick="showDetail(event, ${p.id})">
            <td onclick="event.stopPropagation()"><input type="checkbox" class="checkbox"/></td>
            <td><img src="${p.img}" alt="Patient" class="patient-image"/></td>
            <td>${p.file}</td><td>${p.firstName}</td><td>${p.lastName}</td>
            <td>${p.gender}</td><td>${p.dob}</td><td>${p.phone}</td>
            <td onclick="event.stopPropagation()">
              <div style="display:flex;align-items:center;gap:12px;">
                <button class="new-visit-btn" onclick="openNewVisitFromRow(event, ${p.id})">New Visit</button>
                <div style="display:flex;gap:12px;">
                  <svg class="action-icon" onclick="showDetail(event, ${p.id})" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                  <svg class="action-icon" onclick="showDetail(event, ${p.id})" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                </div>
              </div>
            </td>
          </tr>
        `).join('');
      }

      function setView(viewId, title) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.getElementById(viewId).classList.add('active');
        document.getElementById('page-title').textContent = title;
        document.getElementById(viewId).scrollTop = 0;
      }

      function showList(e) {
        if (e) e.preventDefault();
        setView('view-list', 'Patient List');
      }

      function showDetail(e, patientId) {
        if (e) e.preventDefault();
        const p = patients.find(x => x.id === patientId) || currentPatient;
        if (!p) return;
        currentPatient = p;
        document.getElementById('detail-photo').src = p.img;
        document.getElementById('detail-fullname').textContent = p.firstName + ' ' + p.lastName;
        document.getElementById('detail-gender').textContent = p.gender;
        document.getElementById('detail-email').textContent = p.email;
        document.getElementById('detail-filenum').textContent = p.file;
        document.getElementById('detail-phone').textContent = p.phone;
        document.getElementById('detail-nhes').textContent = p.nhes;
        document.getElementById('detail-address').textContent = p.address;
        document.getElementById('detail-age').textContent = calcAge(p.dob);
        setView('view-detail', p.firstName + ' ' + p.lastName);
      }

      function showNewVisit(e) {
        if (e) e.preventDefault();
        setView('view-new-visit', 'New Visit');
      }

      function openNewVisitFromRow(e, patientId) {
        e.preventDefault(); e.stopPropagation();
        currentPatient = patients.find(x => x.id === patientId);
        setView('view-new-visit', 'New Visit');
      }

      function showAddPatient(e) {
        if (e) e.preventDefault();
        setView('view-add-patient', 'New Patient Information');
        // Init phone fields once
        if (!phoneInstancesInit && window.intlTelInput) {
          const apPhoneIds = ['ap-phone-nationality','ap-phone-1','ap-phone-2','ap-phone-father','ap-phone-mother','ap-phone-emergency'];
          apPhoneIds.forEach(id => {
            const el = document.getElementById(id);
            if (!el) return;
            window.intlTelInput(el, {
              preferredCountries: ['rw','ug','ke','tz','cd','us','gb'],
              separateDialCode: true,
              utilsScript: 'https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js',
            });
          });
          phoneInstancesInit = true;
        }
      }

      // ── Collapse / Expand toggle ──
      function toggleSection(header) {
        const body = header.nextElementSibling;
        const btn  = header.querySelector('.collapse-btn');
        const icon = btn.querySelector('svg');
        if (!body || !body.classList.contains('section-body')) return;

        const isCollapsed = body.classList.contains('collapsed');
        if (isCollapsed) {
          body.classList.remove('collapsed');
          icon.innerHTML = '<polyline points="18 15 12 9 6 15"/>';
          btn.lastChild.textContent = ' Collapse';
        } else {
          body.classList.add('collapsed');
          icon.innerHTML = '<polyline points="6 9 12 15 18 9"/>';
          btn.lastChild.textContent = ' Expand';
        }
      }

      // Prevent collapse-btn click from double-firing header click
      document.querySelectorAll('.collapse-btn').forEach(btn => {
        btn.addEventListener('click', e => {
          e.stopPropagation();
          toggleSection(btn.closest('.section-header'));
        });
      });

      // Init table
      buildTable();
    </script>
  </body>
</html>